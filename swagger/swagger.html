
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Swagger UI</title>
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700|Source+Code+Pro:300,600|Titillium+Web:400,600,700" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/swagger-ui/3.2.2/swagger-ui.css" >
  <style>
    html
    {
      box-sizing: border-box;
      overflow: -moz-scrollbars-vertical;
      overflow-y: scroll;
    }
    *,
    *:before,
    *:after
    {
      box-sizing: inherit;
    }
    body {
      margin:0;
      background: #fafafa;
    }
  </style>
</head>
<body>
<div id="swagger-ui"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/swagger-ui/3.2.2/swagger-ui-bundle.js"> </script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/swagger-ui/3.2.2/swagger-ui-standalone-preset.js"> </script>
<script>
window.onload = function() {
  var spec = {"basepath": "/", "info": {"description": "This page describes the behavior of the Fairdata SSO service, which provides all of the essential SSO functionality in a manner that satisfies the requirements and desired UX for all Fairdata services employing a web UI as the primary means of user interaction (excluding Metax).\n\n*NOTE: This page is only available in a test environment and/or when debugging is enabled. It normally is not available in production.*\n\nThe Fairdata SSO provides a REST API for use by all Fairdata services utilizing the SSO.\n\nThe Fairdata SSO service utilizes the Fairdata AAI proxy for federated authentication, and also queries the CSC IdM LDAP and other sources as needed to aggregate all essential user details based on the authenticated user identity returned by the Fairdata AAI proxy, providing the Fairdata services with a complete, normalized, and unified representation of all user details associated with each successfully initiated session. The Fairdata SSO also manages active sessions, providing single sign-on and sign-off functionality across all Fairdata services for the same user agent.\n\nThe Fairdata SSO employs SAML2 to interact with the Fairdata AAI proxy; however, integration of the Fairdata services with the Fairdata SSO employs this simple and efficient REST API and shared domain cookies.\n\n![Fairdata SSO Architecture](/Fairdata_SSO_Architecture.png)\n\n![Fairdata SSO New Session Process](/Fairdata_SSO_new_session.png)\n\n# Integration Requirements\n\nEach Fairdata service which integrates with the Fairdata SSO must share the same domain as the SSO instance (e.g. `ida.fairdata.fi + sso.fairdata.fi`) and must use the wildcard TLS certificate for that shared domain.\n\n# Domain Cookies\n\nDuring authentication via the Fairdata AAI proxy, the SSO will define the following temporary domain cookies with a prefix derived from the domain of the SSO instance, where all non-alphanumeric characters are replaced with underscores (i.e. the prefix will be one of fairdata_fi, demo_fairdata_fi, fd_rework_csc_fi, fd_stable_csc_fi, fd_test_csc_fi, or fd_dev_csc_fi):\n\n`PREFIX_fd_sso_redirect_url`: JWT encoded URL to be redirected back to upon successful authentication\n\n`PREFIX_fd_sso_initiating_service`: JWT encoded canonical identifier of the service via which login was initiated\n\n`PREFIX_fd_sso_idp`: JWT encoded canonical identifier of the identity provider via which authentication was attempted\n\nUpon successful authentication and initiation of a session, the SSO will define the following domain cookies with a prefix derived from the domain of the SSO instance:\n\n`PREFIX_fd_sso_session_id`: The unique identifier of the current session\n\n`PREFIX_fd_sso_session`: JWT encoded JSON session object containing complete details of the current session\n\nThe service will be able to access the above cookies to obtain all necessary session details, and by which the service can determine whether particular user actions should be permitted and which options and functionality to present to the user.\n\n# SSO Session Validation by Fairdata services\n\nUpon request for a resource from a user agent, the Fairdata service should check for a valid SSO session cookie `PREFIX_fd_sso_session`, and if there is no valid SSO session, it should redirect the user agent to the SSO `/login` endpoint with the appropriate parameters, such that the user agent will be redirected back to the service after successful authentication, and session validation can again be performed per the original request. \n\nIf there is a valid session the service can decode the JWT encoded session object (using the HS256 algorithm and the private TLS wildcard key for its domain) and respond appropriately to the request, and may also initiate a temporary local service-specific session within the service itself so that full SSO session validation does not have to be performed for every request, for a limited period of time.\n\nIf a local service-specific session is employed, it should store as part of the local service-specific session data the session id defined in the decrypted session object, and it should be configured to expire after a period of at most 5 minutes, after which validation of the SSO session validation should again be performed, initiating a new local session if still valid.\n\nIdeally, the service should ensure the PREFIX_fd_sso_session_id cookie still exists for every request, and that the cookie value matches the session id from the decrypted session object when the local session was initiated, terminating any local service-specific session if it does not.\n\nEach Fairdata service should offer users the option to log out of the SSO session, redirecting the user agent to the `/logout` endpoint with the appropriate parameters.\n\n# SSO Session Expiration\n\nThe JWT encoded SSO session object and SSO session cookies will be set to expire after 24 hours. They also will be cleared if the user explicitly logs out from the SSO session.\n\n# Cookies Notification\n\nThe SSO provides a consistent means to notify users regarding the use of cookies by Fairdata services. Each Fairdata service should include the following snippet in the &lt;head> element of every page:\n\n<pre><code>&lt;link rel=\"stylesheet\" href=\"https://sso.fairdata.fi/notification.css\"&gt;\n&lt;script type=\"text/javascript\" src=\"https://sso.fairdata.fi/notification.js\"&gt;&lt;/script&gt;</code></pre>\n\nwhere `https://sso.fairdata.fi` is replaced, as appropriate, with the root URL of the particular SSO instance being used (e.g. `sso.demo.fairdata.fi`, `sso.fd-stable.csc.fi`, etc). \n\nIt is recommended that the root URL of the SSO API be stored in a configuration variable and inserted into the snippet at both locations, so that the service code is configurable for each particular domain (i.e. `SSO_API=\"https://sso.fairdata.csc.fi\"`).\n\nThe Javascript snippet will check if the user has been notified yet regarding use of cookies, by checking if the `PREFIX_fd_sso_notifiction shown` domain cookie exists, and if not, will present the notification accordingly. When the user closes the notification, the snippet will create the `PREFIX_fd_sso_notification_shown` domain cookie which will expire after one year.\n\n# SSO Session Object\n\nThe SSO session is encoded as a JSON object containing the following fields:\n\n- **id**: A string containing the unique idenitifier of the session\n- **initiating_service**: A string containing the token identifier of the service from which the session was initiated\n- **language**: A string containing the token identifier of the language in which the session was initiated\n- **initiated**: A string containing an ISO formatted datetime string indicating when the session was initiated\n- **expiration**: A string containing an ISO formatted datetime string indicating when the session cookie will expire\n- **exp**: An integer value corresponding to a unix time value indicating when the session cookie will expire\n- **redirect_url**: A string containing the URL to which the client should be redirected after a successful authentication\n- **authenticated_user**: A JSON object with details about the authenticated user containing the following fields:\n   - **id**: A string containing the username of the authenticated user\n   - **firstname**: A string containing the first name of the authenticated user\n   - **lastname**: A string containing the last name of the authenticated user\n   - **email**: A string containing the email address of the authenticated user\n   - **identity_provider**: A string containing the token identifier of the identity provider via which the user was authenticated\n   - **organization**: A JSON object with details about the authenticated user's organization containing the following fields:\n      - **id**: A string containing the authenticated user's organization identifier\n      - **name**: A string containing the authenticated user's organization presentation name\n- **fairdata_user**: A JSON object with details about the Fairdata / CSC user account containing the following fields:\n   - **id**: A string containing the CSC username of the authenticated user\n   - **locked**: A boolean value indicating whether the user's CSC account is locked\n- **projects**: A JSON object containing one or more fields corresponding to the names of all projects of which the authenticated user is a member, where the value of each project name field is a JSON object containing zero or more of the following fields:\n   - **services**: An array of service token strings, representing the services for which the project has use rights for the authenticated user\n- **services**: A JSON object containing one or more fields corresponding to the names of all services which the authenticated user has use rights, where the value of each service name field is a JSON object containing zero or more of the following fields:\n   - **projects**: An array of project name strings, representing the projects which have use rights to the service for the authenticated user\n   - **admin_organizations**: Only for Qvain. An array of organization domain strings, representing the organizations for which the authenticated user has administrator rights in Qvain\n\n**NOTE:** Any other fields which may be present in the session object are either experimental, or are for testing or debugging, and should **NOT** be used by any service integrating with the Fairdata SSO.\n\nExample:\n\n```\n{\n    \"id\": \"2021-12-01-084520e41caf971a8c481bbab5787454b3a196\",\n    \"initiating_service\": \"IDA\",\n    \"language\": \"en\",\n    \"initiated\": \"2021-12-01T08:45:20Z\",\n    \"expiration\": \"2021-12-02T08:45:20Z\",\n    \"exp\": 1638434720,\n    \"redirect_url\": \"https://ida.fairdata.fi/\",\n    \"authenticated_user\": {\n        \"id\": \"john_doe\",\n        \"firstname\": \"John\",\n        \"lastname\": \"Doe\",\n        \"email\": \"john.doe@csc.fi\",\n        \"identity_provider\": \"CSCID\",\n        \"organization\": {\n            \"id\": \"csc.fi\",\n            \"name\": \"CSC - Tieteen tietotekniikan keskus Oy\"\n        }\n    },\n    \"fairdata_user\": {\n        \"id\": \"john_doe\",\n        \"locked\": false\n    },\n    \"projects\": {\n        \"12345\": {\n            \"services\": [\n                \"ETSIN\",\n                \"IDA\",\n                \"QVAIN\"\n            ]\n        }\n    },\n    \"services\": {\n        \"AVAA\": {},\n        \"ETSIN\": {\n            \"projects\": [\n                \"12345\"\n            ]\n        },\n        \"IDA\": {\n            \"projects\": [\n                \"12345\"\n            ]\n        },\n        \"QVAIN\": {\n            \"projects\": [\n                \"12345\"\n            ],\n            \"admin_organizations\": [\n                \"csc.fi\"\n            ]\n        }\n    }\n}\n```\n", "title": "Fairdata SSO", "version": "1.0.0"}, "paths": {"/acs/": {"post": {"parameters": [{"description": "The canonical identifier of the service via which login is being initiated (cookie set by SSO before redirecting to AAI proxy)", "in": "cookie", "name": "fd_sso_initiating_service", "required": true, "type": "string"}, {"description": "The URL to be redirected back to upon successful authentication (cookie set by SSO before redirecting to AAI proxy)", "in": "cookie", "name": "fd_sso_redirect_url", "required": true, "type": "string"}, {"description": "The canonical identifier of the identity provider via which authentication should be attempted (cookie set by SSO before redirecting to AAI proxy)", "in": "cookie", "name": "fd_sso_idp", "required": true, "type": "string"}], "produces": ["text/html"], "responses": {"302": {"description": "Redirection to the redirection URL after initiating session"}, "400": {"description": "Required parameter missing"}}, "summary": "The endpoint used by the SAML library on auth.login call from the AAI proxy after successful authentication", "tags": ["AAI Proxy"]}}, "/auth": {"get": {"parameters": [{"description": "The canonical identifier of the service via which login is being initiated", "enum": ["IDA", "ETSIN", "QVAIN", "METAX", "PAS", "AVAA"], "in": "query", "name": "service", "required": true, "type": "string"}, {"description": "The URL to be redirected back to upon successful authentication", "in": "query", "name": "redirect_url", "required": true, "type": "string"}, {"description": "The canonical identifier of the identity provider via which authentication should be attempted", "enum": ["CSCID", "HAKA", "VIRTU"], "in": "query", "name": "idp", "required": true, "type": "string"}, {"description": "(internal) A comma delimited list of tokens indicating any errors detected from a prior authentication attempt", "in": "query", "name": "errors", "required": false, "type": "string"}], "produces": ["text/html"], "responses": {"302": {"description": "Redirection to the AAI proxy for authentication via the selected identity provider"}, "400": {"description": "Required parameter missing"}}, "summary": "Initiate authentication via a selected identity provider", "tags": ["Internal"]}}, "/login": {"get": {"parameters": [{"description": "The canonical identifier of the service from which login is being initiated", "enum": ["IDA", "ETSIN", "QVAIN", "METAX", "PAS", "AVAA"], "in": "query", "name": "service", "required": true, "type": "string"}, {"description": "The url to be redirected back to upon successful authentication", "in": "query", "name": "redirect_url", "required": true, "type": "string"}, {"description": "The canonical identifier of the identity provider via which authentication was last attempted", "enum": ["CSCID", "HAKA", "VIRTU"], "in": "query", "name": "idp", "required": false, "type": "string"}, {"description": "A two letter language code, overrides any browser or cookie defined language setting", "enum": ["en", "fi", "sv"], "in": "query", "name": "language", "required": false, "type": "string"}, {"description": "A comma separated list of one or more predefined error tokens indicating reasons for authentication failure", "in": "query", "name": "errors", "required": false, "type": "string"}], "produces": ["text/html"], "responses": {"200": {"description": "Returns the service specific login page presenting authentication guidance and the supported identity providers"}, "400": {"description": "Required parameter missing"}}, "summary": "Log in to the Fairdata SSO", "tags": ["Integration"]}}, "/logout": {"get": {"parameters": [{"description": "The canonical identifier of the service from which logout is being initiated", "enum": ["IDA", "ETSIN", "QVAIN", "METAX", "PAS", "AVAA"], "in": "query", "name": "service", "required": true, "type": "string"}, {"description": "The URL to be redirected back to upon successful logout", "in": "query", "name": "redirect_url", "required": true, "type": "string"}, {"description": "A two letter language code, overrides any browser or cookie defined language setting", "enum": ["en", "fi", "sv"], "in": "query", "name": "language", "required": false, "type": "string"}], "produces": ["text/html"], "responses": {"200": {"description": "Returns a logout confirmation page warning that the current session will be terminated for all Fairdata services"}, "400": {"description": "Required parameter missing"}}, "summary": "Log out of the Fairdata SSO", "tags": ["Integration"]}}, "/preservation_agreements": {"post": {"parameters": [{"description": "The user id (cn)", "in": "query", "name": "id", "required": true, "type": "string"}, {"description": "The trusted service token", "in": "query", "name": "token", "required": true, "type": "string"}], "produces": ["application/json"], "responses": {"200": {"description": "A summary of user-specific preservation agreement privileges of the specified user"}, "400": {"description": "Required parameter missing"}, "401": {"description": "Invalid token"}, "404": {"description": "No preservation agreements found for specified user"}}, "summary": "Return a summary of user-specific preservation agreement privileges of the specified user", "tags": ["Integration"]}}, "/project_status": {"post": {"parameters": [{"description": "The project id (cn)", "in": "query", "name": "id", "required": true, "type": "string"}, {"description": "The trusted service token", "in": "query", "name": "token", "required": true, "type": "string"}], "produces": ["application/json"], "responses": {"200": {"description": "A summary of the specified project, including user membership"}, "400": {"description": "Required parameter missing"}, "401": {"description": "Invalid token"}}, "summary": "Return a summary of the current status of the specified project, including user membership (available only to internal trusted services)", "tags": ["Integration"]}}, "/saml_metadata/": {"get": {"produces": ["text/xml"], "responses": {"200": {"description": "OK"}}, "summary": "Returns the public SAML XML metadata for the SSO service", "tags": ["Informational"]}}, "/sls/": {"post": {"parameters": [{"description": "The identifier of the current session (cookie set by SSO as part of session initiation)", "in": "cookie", "name": "fd_sso_session_id", "required": false, "type": "string"}, {"default": "https://fairdata.fi", "description": "The URL to be redirected back to upon successful authentication (cookie set by SSO before redirecting to AAI proxy)", "in": "cookie", "name": "fd_sso_redirect_url", "required": false, "type": "string"}], "produces": ["text/html"], "responses": {"302": {"description": "Redirection to the redirection URL after terminating session"}, "400": {"description": "Required parameter missing"}}, "summary": "The endpoint used by the SAML library on auth.logout call from the AAI proxy (not used, but required by SAML library)", "tags": ["AAI Proxy"]}}, "/swagger": {"get": {"parameters": null, "produces": ["text/html"], "responses": {"200": {"description": "OK"}}, "summary": "Returns the online Swagger API documentation page", "tags": ["Informational"]}}, "/terminate": {"post": {"parameters": [{"description": "The URL to be redirected back to", "in": "query", "name": "redirect_url", "required": true, "type": "string"}], "produces": ["text/html"], "responses": {"200": {"description": "Terminates the active session, if any, and redirects to the specified redirection URL"}, "400": {"description": "Required parameter missing"}}, "summary": "Terminate the active Fairdata SSO session, if any", "tags": ["Internal"]}}, "/test": {"get": {"parameters": null, "produces": ["text/html"], "responses": {"200": {"description": "OK"}, "400": {"description": "Bad request (when queried in production environment)"}}, "summary": "When in a test environment, returns a web page for manually testing SSO functionality", "tags": ["Internal"]}}, "/user_status": {"post": {"parameters": [{"description": "The user id (cn)", "in": "query", "name": "id", "required": true, "type": "string"}, {"description": "The trusted service token", "in": "query", "name": "token", "required": true, "type": "string"}], "produces": ["application/json"], "responses": {"200": {"description": "A summary of the specified user, including project membership and whether the account is disabled"}, "400": {"description": "Required parameter missing"}, "401": {"description": "Invalid token"}}, "summary": "Return a summary of the current status of the specified user, including project membership and whether the account is disabled (available only to internal trusted services)", "tags": ["Integration"]}}}, "schemes": ["https"], "swagger": "2.0", "tags": [{"description": "For Fairdata Service Integration", "name": "Integration"}, {"description": "For SAML Integration with the AAI Proxy", "name": "AAI Proxy"}, {"description": "For SSO Internal Functions", "name": "Internal"}]};
  // Build a system
  const ui = SwaggerUIBundle({
    spec: spec,
    dom_id: '#swagger-ui',
    deepLinking: true,
    presets: [
      SwaggerUIBundle.presets.apis,
      SwaggerUIStandalonePreset
    ],
    plugins: [
      SwaggerUIBundle.plugins.DownloadUrl
    ],
    layout: "StandaloneLayout"
  })
  window.ui = ui
}
</script>
</body>
</html>
